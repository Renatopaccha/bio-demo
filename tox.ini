[tox]
envlist = py38,py39,py310,py311,py312
minversion = 3.20.0
skip_missing_interpreters = true

[testenv]
description = Run unit tests with pytest
deps =
    -r{toxinidir}/requirements.txt
    -r{toxinidir}/requirements-dev.txt
commands =
    pytest {posargs:tests/} -v --tb=short

[testenv:coverage]
description = Run tests and generate coverage report
commands =
    pytest tests/ \
        --cov=modules \
        --cov-report=term-missing \
        --cov-report=html \
        --cov-report=xml \
        -v

[testenv:lint]
description = Run mypy type checking
skip_install = false
commands =
    mypy modules/ --ignore-missing-imports

[testenv:format]
description = Format code with black
skip_install = false
commands =
    black modules/ tests/ setup.py

[testenv:py{38,39,310,311,312}]
description = Run tests on Python {envname}
commands =
    pytest tests/ -v --tb=short

[testenv:py311-coverage]
description = Full test and coverage on Python 3.11
commands =
    pytest tests/ \
        --cov=modules \
        --cov-report=term-missing \
        --cov-report=html \
        --cov-append \
        -v

[pytest]
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*
addopts = --tb=short

[coverage:run]
source = modules
omit =
    */tests/*
    */site-packages/*
    setup.py

[coverage:report]
precision = 2
show_missing = true
skip_covered = false
exclude_lines =
    pragma: no cover
    def __repr__
    raise AssertionError
    raise NotImplementedError
    if __name__ == .__main__.:
